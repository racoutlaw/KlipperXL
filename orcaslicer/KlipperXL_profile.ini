# XlKlipper OrcaSlicer Profile
# Prusa XL running Klipper with multi-tool support
# Created: 2026-02-04
#
# Import this profile into OrcaSlicer:
# 1. Open OrcaSlicer
# 2. Go to File > Import > Import Config Bundle
# 3. Select this file
#
# Or manually copy settings from the [print:*XL_Multitool*] section

[vendor]
name = XlKlipper
config_version = 1.0.0

# =============================================================================
# PRINTER MODEL DEFINITION
# =============================================================================

[printer_model:XlKlipper_5T]
name = Prusa XL (Klipper) 5-Tool
variants = 0.4
technology = FFF
family = XL
bed_model =
bed_texture =
default_materials = Generic PLA @XLKLIPPER; Generic PETG @XLKLIPPER

# =============================================================================
# PRINTER SETTINGS
# =============================================================================

[printer:XlKlipper 5-Tool 0.4 nozzle]
printer_model = XlKlipper_5T
printer_variant = 0.4
printer_technology = FFF
default_print_profile = 0.20mm Standard @XLKLIPPER
default_filament_profile = Generic PLA @XLKLIPPER

# Bed size
bed_shape = 0x0,360x0,360x360,0x360
max_print_height = 360

# Extruder count (5 tools)
extruders_count = 5
single_extruder_multi_material = 1

# Nozzle settings (all 5 tools)
nozzle_diameter = 0.4,0.4,0.4,0.4,0.4
nozzle_type = hardened_steel
retract_length = 0.8,0.8,0.8,0.8,0.8
retract_speed = 60,60,60,60,60
deretract_speed = 60,60,60,60,60
retract_lift = 0.4,0.4,0.4,0.4,0.4
retract_before_wipe = 70%,70%,70%,70%,70%
retract_length_toolchange = 30,30,30,30,30
wipe = 1,1,1,1,1
z_offset = 0

# Machine limits (matched to printer.cfg)
machine_max_feedrate_x = 400
machine_max_feedrate_y = 400
machine_max_feedrate_z = 12
machine_max_feedrate_e = 120
machine_max_acceleration_x = 1800
machine_max_acceleration_y = 1800
machine_max_acceleration_z = 200
machine_max_acceleration_e = 5000
machine_max_jerk_x = 5
machine_max_jerk_y = 5
machine_max_jerk_z = 0.4
machine_max_jerk_e = 5

# G-code flavor
gcode_flavor = klipper

# Start/End G-code
start_gcode = START_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single] TOOL=[initial_extruder] TOTAL_LAYER_COUNT={total_layer_count} X0={first_layer_print_min[0]} Y0={first_layer_print_min[1]} X1={first_layer_print_max[0]} Y1={first_layer_print_max[1]}
end_gcode = END_PRINT
before_layer_gcode = ;BEFORE_LAYER_CHANGE\n;[layer_z]\nG92 E0\n_ON_LAYER_CHANGE LAYER={layer_num + 1}
layer_gcode = ;AFTER_LAYER_CHANGE\n;[layer_z]
toolchange_gcode = T[next_extruder]
between_objects_gcode = ;BETWEEN_OBJECTS\nG92 E0
time_lapse_gcode = TIMELAPSE_TAKE_FRAME
thumbnails = 64x64/PNG, 400x300/PNG

# Pause G-code
pause_print_gcode = PAUSE
color_change_gcode =

# =============================================================================
# PRINT PROFILES - PRUSA XL MULTI-TOOL SETTINGS
# =============================================================================

[print:*common_xlklipper*]
# Layer heights
layer_height = 0.2
first_layer_height = 0.2

# Perimeters
perimeters = 3
perimeter_speed = 100
external_perimeter_speed = 50%
small_perimeter_speed = 50%

# Infill
fill_density = 15%
fill_pattern = grid
infill_speed = 150
solid_infill_speed = 100
top_solid_infill_speed = 50

# Top/bottom layers
top_solid_layers = 5
bottom_solid_layers = 4

# First layer
first_layer_speed = 25
first_layer_extrusion_width = 0.5

# Extrusion widths (Prusa-matched)
extrusion_width = 0.45
perimeter_extrusion_width = 0.45
external_perimeter_extrusion_width = 0.45
infill_extrusion_width = 0.45
solid_infill_extrusion_width = 0.45
top_infill_extrusion_width = 0.4

# Speeds
travel_speed = 400
travel_speed_z = 10

# Acceleration (Prusa XL values)
default_acceleration = 1250
bridge_acceleration = 1000
perimeter_acceleration = 1000
infill_acceleration = 2000
solid_infill_acceleration = 1500
top_solid_infill_acceleration = 800
travel_acceleration = 5000
first_layer_acceleration = 800

# Support
support_material = 0
support_material_threshold = 45

# Skirt/brim
skirts = 0
brim_width = 0

# Arc fitting (Prusa uses this)
arc_fitting = emit_center

# Object labeling for exclude_object
gcode_label_objects = firmware

# =============================================================================
# WIPE TOWER / PRIME TOWER - PRUSA XL STYLE (CRITICAL SETTINGS)
# =============================================================================

[print:*XL_Multitool*]
inherits = *common_xlklipper*

# *** PRUSA-STYLE CONICAL WIPE TOWER ***
# These settings create a stable conical tower like Prusa uses

# Enable wipe tower
wipe_tower = 1

# CONE ANGLE - Creates conical (tapered) tower shape
# 25 degrees gives wider base for stability
# Set to 0 for traditional rectangular tower
wipe_tower_cone_angle = 25

# ROTATION - Rotate tower 90 degrees
# Prusa rotates the tower for better placement
wipe_tower_rotation_angle = 90

# EXTRA SPACING - 150% spacing between purge lines
# More spacing = less dense tower = uses less filament
wipe_tower_extra_spacing = 150

# Brim around tower base for adhesion
wipe_tower_brim_width = 3

# Bridging (layers that bridge gaps in sparse tower)
wipe_tower_bridging = 8

# Tower position (adjust for your bed layout)
# Default near front-right, away from tools at back
wipe_tower_x = 300
wipe_tower_y = 50

# Tower width
wipe_tower_width = 60

# Don't skip sparse layers (keeps tower stable)
wipe_tower_no_sparse_layers = 0

# =============================================================================
# OOZE PREVENTION / STANDBY TEMPERATURES
# =============================================================================

# Enable ooze prevention
ooze_prevention = 1

# STANDBY TEMPERATURE DELTA
# Parked tools are cooled by this amount below active temp
# -110 means if active tool is 230C, parked tools are 120C
# This DRAMATICALLY reduces ooze and stringing
standby_temperature_delta = -110

# =============================================================================
# MULTI-MATERIAL PRIMING
# =============================================================================

# Disable MMU-style priming (we use wipe tower instead)
single_extruder_multi_material_priming = 0

# Filament ramming (for tool changes)
# These are Prusa defaults for Nextruder
filament_ramming_parameters = "120 100 6.6 6.8 7.2 7.6 7.9 8.2 8.7 9.4 9.9 10.0| 0.05 6.6 0.45 6.8 0.95 7.8 1.45 8.3 1.95 9.7 2.45 10 2.95 7.6 3.45 7.6 3.95 7.6 4.45 7.6 4.95 7.6"

# =============================================================================
# NAMED PRINT PROFILES
# =============================================================================

[print:0.20mm Standard @XLKLIPPER]
inherits = *XL_Multitool*
layer_height = 0.2
first_layer_height = 0.2
perimeters = 3
top_solid_layers = 5
bottom_solid_layers = 4

[print:0.15mm Quality @XLKLIPPER]
inherits = *XL_Multitool*
layer_height = 0.15
first_layer_height = 0.2
perimeters = 4
top_solid_layers = 7
bottom_solid_layers = 5
perimeter_speed = 80
infill_speed = 120

[print:0.28mm Draft @XLKLIPPER]
inherits = *XL_Multitool*
layer_height = 0.28
first_layer_height = 0.28
perimeters = 2
top_solid_layers = 4
bottom_solid_layers = 3
perimeter_speed = 120
infill_speed = 180

# =============================================================================
# FILAMENT PROFILES
# =============================================================================

[filament:*common_filament*]
filament_diameter = 1.75
extrusion_multiplier = 1
filament_max_volumetric_speed = 15

[filament:Generic PLA @XLKLIPPER]
inherits = *common_filament*
filament_type = PLA
temperature = 215
first_layer_temperature = 220
bed_temperature = 60
first_layer_bed_temperature = 60
fan_always_on = 1
cooling = 1
min_fan_speed = 100
max_fan_speed = 100
bridge_fan_speed = 100
filament_density = 1.24
filament_cost = 20

[filament:Generic PETG @XLKLIPPER]
inherits = *common_filament*
filament_type = PETG
temperature = 240
first_layer_temperature = 245
bed_temperature = 85
first_layer_bed_temperature = 85
fan_always_on = 1
cooling = 1
min_fan_speed = 30
max_fan_speed = 50
bridge_fan_speed = 100
filament_density = 1.27
filament_cost = 25
filament_max_volumetric_speed = 12

[filament:Generic ASA @XLKLIPPER]
inherits = *common_filament*
filament_type = ASA
temperature = 260
first_layer_temperature = 265
bed_temperature = 100
first_layer_bed_temperature = 100
fan_always_on = 0
cooling = 1
min_fan_speed = 20
max_fan_speed = 30
bridge_fan_speed = 80
filament_density = 1.07
filament_cost = 30
filament_max_volumetric_speed = 11
